Class App.Installer Extends %RegisteredObject
{

XData Install [ XMLNamespace = INSTALLER ]
{
<Manifest> 
    <Log Text="Creating namespaces for Workshop..." Level="0"/> 
    <Namespace Name="DEV" Create="yes" Ensemble=""> 
        <Configuration> 
            <Database Name="DEV-DATA" Dir="/usr/irissys/mgr/dev-data" Create="yes" MountRequired="true" Resource="%DB_DEFAULT" PublicPermissions="RW" MountAtStartup="true"/> 
            <Database Name="DEV-APP" Dir="/usr/irissys/mgr/dev-code" Create="yes" MountRequired="true" Resource="%DB_DEFAULT" PublicPermissions="RW" MountAtStartup="true"/> 
        </Configuration>
    </Namespace>
    <Namespace Name="PROD" Create="yes" Ensemble=""> 
        <Configuration> 
            <Database Name="PROD-DATA" Dir="/usr/irissys/mgr/prod-data" Create="yes" MountRequired="true" Resource="%DB_DEFAULT" PublicPermissions="RW" MountAtStartup="true"/> 
            <Database Name="PROD-APP" Dir="/usr/irissys/mgr/prod-code" Create="yes" MountRequired="true" Resource="%DB_DEFAULT" PublicPermissions="RW" MountAtStartup="true"/> 
        </Configuration>
    </Namespace>
    <Namespace Name="%SYS" Create="no">
        <Invoke Class="Security.Users" Method="Import" CheckStatus="true">
            <Arg Value="/opt/irisapp/install/users.xml"/>
        </Invoke>
    </Namespace>
</Manifest>
}

/// This is a method generator whose code is generated by XGL. 
/// Main setup method
ClassMethod RunManifest(ByRef pVars, pLogLevel As %Integer = 0, pInstaller As %Installer.Installer) As %Status [ CodeMode = objectgenerator, Internal ]
{
    Quit ##class(%Installer.Manifest).%Generate(%compiledclass, %code, "Install")
}

/// Entry point    
ClassMethod Run(ByRef vars) As %Status
{
    try { 
        write "START INSTALLER",! 
        
        set sc = ..RunManifest(.vars) 
        if $$$ISOK(sc) {
            write !,"INSTALLER SUCCESS"
        }
        $$$ThrowOnError(sc)

    } catch ex { 
        set sc = ex.AsStatus() 
        write $System.Status.GetErrorText(sc),! 
        do $SYSTEM.Process.Terminate($JOB,1) 
    } 
    quit sc
}

}
